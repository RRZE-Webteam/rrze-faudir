/*
* JavaScript Definitions for: 
* Plugin: rrze-faudir
* Version: 2.5.24
*/
jQuery(function(n){n("#clear-cache-button").on("click",function(){window.rrzeFaudirAjax&&confirm(rrzeFaudirAjax.confirm_clear_cache)&&n.post(rrzeFaudirAjax.ajax_url,{action:"rrze_faudir_clear_cache",security:rrzeFaudirAjax.api_nonce}).done(function(r){alert(r&&r.success?r.data:"Error clearing cache.")})}),n("#import-fau-person-button").on("click",function(){var e;window.rrzeFaudirAjax&&confirm(rrzeFaudirAjax.confirm_import)&&(n("#migration-progress").empty().append('<div id="import-progress"><div class="progress-bar" style="width:0%;height:20px;background-color:#4CAF50;"></div></div><div id="import-response" style="margin-top:10px;"></div>'),e=setInterval(function(){var r=n("#import-progress .progress-bar"),e=parseInt(r.css("width"))/n("#import-progress").width()*100||0;r.css("width",Math.min(e+10,90)+"%")},500),n.post(rrzeFaudirAjax.ajax_url,{action:"rrze_faudir_import_fau_person",security:rrzeFaudirAjax.api_nonce}).done(function(r){clearInterval(e),n("#import-progress .progress-bar").css("width","100%"),r.success?(r=String(r.data).replace(/\n/g,"</li><li>"),n("#import-response").html('<ul style="max-width:75ch;"><li>'+r+"</li></ul>")):n("#import-response").html("<p>No contact from FAU Person imported.</p>")}).fail(function(){clearInterval(e),n("#import-progress .progress-bar").css("width","100%"),n("#import-response").html("<p>An error occurred during the import.</p>")}))}),n("#search-person-form").length&&(n("#search-person-form input").on("keypress",function(r){13===r.which&&(r.preventDefault(),n("#search-person-form").submit())}),n("#search-person-form input").on("input",function(){var r=!0;n('#search-person-form input[type="text"], #search-person-form input[type="email"]').each(function(){""!==n(this).val()&&(r=!1)}),1!==n("#given-name").val().length&&1!==n("#family-name").val().length||(r=!0),n("#search-person-form button").prop("disabled",r)}),n("#search-person-form").on("submit",function(r){var e,a,t,i;r.preventDefault(),window.rrzeFaudirAjax&&(r=n("#person-id").val().trim(),e=n("#given-name").val().trim(),a=n("#family-name").val().trim(),t=n("#email").val().trim(),i=n("#include-default-org").is(":checked")?"1":"0",r||e||a||t?n.post(rrzeFaudirAjax.ajax_url,{action:"rrze_faudir_search_person",security:rrzeFaudirAjax.api_nonce,person_id:r,given_name:e,family_name:a,email:t,include_default_org:i}).done(function(r){n("#contacts-list").html(r.success?r.data:"<p>"+r.data+"</p>")}).fail(function(){n("#contacts-list").html("<p>An error occurred during the request.</p>")}):n("#contacts-list").html("<p>Please enter a valid search term.</p>"))})),n(document).on("click",".add-person",function(){var a,r,e,t,i;window.rrzeFaudirAjax&&(r=(a=n(this)).data("name"),e=a.data("id"),t=a.data("include-default-org"),i=a.data("functionLabel")||[],a.prop("disabled",!0).html('<span class="dashicons dashicons-update"></span> '+rrzeFaudirAjax.add_text),n.post(rrzeFaudirAjax.ajax_url,{action:"rrze_faudir_create_custom_person",security:rrzeFaudirAjax.api_nonce,person_name:r,person_id:e,include_default_org:t,functions:i}).done(function(r){var e;r.success?(e=n("<a>",{href:r.data.edit_url,class:"edit-person button",html:'<span class="dashicons dashicons-edit"></span> '+rrzeFaudirAjax.edit_text}),a.replaceWith(e)):alert("Error creating custom person: "+(r.data||"Unknown error"))}).fail(function(){alert("An error occurred while creating the custom person.")}).always(function(){a.prop("disabled",!1).html(rrzeFaudirAjax.add_text)}))}),n("#search-org-form").length&&(n("#search-org-form").on("submit",function(r){r.preventDefault(),window.rrzeFaudirAjax&&((r=n("#org-search").val().trim())?n.post(rrzeFaudirAjax.ajax_url,{action:"rrze_faudir_search_org",security:rrzeFaudirAjax.api_nonce,search_term:r}).done(function(r){n("#organizations-list").html(r.success?r.data:"<p>"+r.data+"</p>")}).fail(function(){n("#organizations-list").html("<p>An error occurred during the request.</p>")}):n("#organizations-list").html("<p>Please enter a search term.</p>"))}),n("#search-org-form input").on("keypress",function(r){13===r.which&&(r.preventDefault(),n("#search-org-form").submit())}))});