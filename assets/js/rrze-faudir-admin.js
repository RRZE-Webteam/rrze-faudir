/*
* JavaScript Definitions for: 
* Plugin: rrze-faudir
* Version: 2.4.4-4
*/
jQuery(function(o){let e=1;var r,a=o(".wrap.faudir-settings"),t=a.find(".nav-tab-wrapper");let n=0<t.find('a[href^="#"]').length;function i(r){o.ajax({url:rrzeFaudirAjax.ajax_url,method:"POST",data:{action:"rrze_faudir_fetch_contacts",security:rrzeFaudirAjax.api_nonce,page:r},success:function(r){r.success?(o("#contacts-list").html(r.data),n&&localStorage.setItem("activeTab","#tab-5")):o("#contacts-list").html("<p>An error occurred while loading contacts.</p>")},error:function(){o("#contacts-list").html("<p>An error occurred during the request.</p>")}})}n?(r=localStorage.getItem("activeTab")||"#tab-1",o(".nav-tab").removeClass("nav-tab-active"),o('a[href="'+r+'"]').addClass("nav-tab-active"),o(".tab-content").hide(),o(r).show(),t.on("click",".nav-tab",function(r){r.preventDefault(),o(".nav-tab").removeClass("nav-tab-active"),o(this).addClass("nav-tab-active"),o(".tab-content").hide();r=o(this).attr("href");o(r).show(),localStorage.setItem("activeTab",r)})):(a.find(".tab-content").show(),t.on("click",".nav-tab",function(){})),o(document).on("click",".prev-page",function(r){r.preventDefault(),1<e&&i(--e)}),o(document).on("click",".next-page",function(r){r.preventDefault(),i(++e)}),o("#clear-cache-button").length&&o("#clear-cache-button").on("click",function(){confirm(rrzeFaudirAjax.confirm_clear_cache)&&o.post(rrzeFaudirAjax.ajax_url,{action:"rrze_faudir_clear_cache",security:rrzeFaudirAjax.api_nonce},function(r){r.success?alert(r.data):alert("Error clearing cache.")})}),o("#import-fau-person-button").length&&o("#import-fau-person-button").on("click",function(){var e;confirm(rrzeFaudirAjax.confirm_import)&&(o("#migration-progress").empty().append('<div id="import-progress"><div class="progress-bar" style="width:0%;height:20px;background-color:#4CAF50;"></div></div><div id="import-response" style="margin-top:10px;"></div>'),e=setInterval(function(){var r=o("#import-progress .progress-bar"),e=parseInt(r.css("width"))/o("#import-progress").width()*100||0,e=Math.min(e+10,90);r.css("width",e+"%")},500),o.post(rrzeFaudirAjax.ajax_url,{action:"rrze_faudir_import_fau_person",security:rrzeFaudirAjax.api_nonce},function(r){clearInterval(e),o("#import-progress .progress-bar").css("width","100%"),r.success?(r=String(r.data).replace(/\n/g,"</li><li>"),o("#import-response").html('<ul style="max-width:75ch;"><li>'+r+"</li></ul>")):o("#import-response").html("<p>No contact from FAU Person imported.</p>")}).fail(function(){clearInterval(e),o("#import-progress .progress-bar").css("width","100%"),o("#import-response").html("<p>An error occurred during the import.</p>")}))}),o("#search-person-form").length&&(o("#search-person-form input").on("keypress",function(r){13===r.which&&(r.preventDefault(),o("#search-person-form").submit())}),o("#search-person-form input").on("input",function(){var r=!0;o('#search-person-form input[type="text"], #search-person-form input[type="email"]').each(function(){""!==o(this).val()&&(r=!1)}),1!==o("#given-name").val().length&&1!==o("#family-name").val().length||(r=!0),o("#search-person-form button").prop("disabled",r)}),o("#search-person-form").on("submit",function(r){r.preventDefault();var r=o("#person-id").val().trim(),e=o("#given-name").val().trim(),a=o("#family-name").val().trim(),t=o("#email").val().trim(),n=o("#include-default-org").is(":checked")?"1":"0";r||e||a||t?o.ajax({url:rrzeFaudirAjax.ajax_url,method:"POST",data:{action:"rrze_faudir_search_person",security:rrzeFaudirAjax.api_nonce,person_id:r,given_name:e,family_name:a,email:t,include_default_org:n},success:function(r){r.success?o("#contacts-list").html(r.data):o("#contacts-list").html("<p>"+r.data+"</p>")},error:function(){o("#contacts-list").html("<p>An error occurred during the request.</p>")}}):o("#contacts-list").html("<p>Please enter a valid search term.</p>")})),o(document).on("click",".add-person",function(){var a=o(this),r=a.data("name"),e=a.data("id"),t=a.data("include-default-org"),n=a.data("functionLabel")||[];a.prop("disabled",!0).html('<span class="dashicons dashicons-update"></span> '+rrzeFaudirAjax.add_text),o.ajax({url:rrzeFaudirAjax.ajax_url,method:"POST",data:{action:"rrze_faudir_create_custom_person",security:rrzeFaudirAjax.api_nonce,person_name:r,person_id:e,include_default_org:t,functions:n},success:function(r){var e;r.success?(e=o("<a>",{href:r.data.edit_url,class:"edit-person button",html:'<span class="dashicons dashicons-edit"></span> '+rrzeFaudirAjax.edit_text}),a.replaceWith(e)):alert("Error creating custom person: "+(r.data||"Unknown error"))},error:function(){alert("An error occurred while creating the custom person.")},complete:function(){a.prop("disabled",!1).html("Add")}})}),o("#search-org-form").length&&(o("#search-org-form").on("submit",function(r){r.preventDefault();r=o("#org-search").val().trim();0<r.length?o.ajax({url:rrzeFaudirAjax.ajax_url,method:"POST",data:{action:"rrze_faudir_search_org",security:rrzeFaudirAjax.api_nonce,search_term:r},success:function(r){r.success?o("#organizations-list").html(r.data):o("#organizations-list").html("<p>"+r.data+"</p>")},error:function(){o("#organizations-list").html("<p>An error occurred during the request.</p>")}}):o("#organizations-list").html("<p>Please enter a search term.</p>")}),o("#search-org-form input").on("keypress",function(r){13===r.which&&(r.preventDefault(),o("#search-org-form").submit())}))}),jQuery(document).ready(function(r){var e='[faudir identifier="'+r("#hidden-person-id").val()+'"]';r("#generated-shortcode").val(e),r("#copy-shortcode").on("click",function(){r("#generated-shortcode").select(),document.execCommand("copy"),alert("Shortcode copied to clipboard!")})});