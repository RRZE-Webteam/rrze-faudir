/*
* JavaScript Definitions for: 
* Plugin: rrze-faudir
* Version: 2.4.4-5
*/
jQuery(function(i){i("#clear-cache-button").on("click",function(){window.rrzeFaudirAjax&&confirm(rrzeFaudirAjax.confirm_clear_cache)&&i.post(rrzeFaudirAjax.ajax_url,{action:"rrze_faudir_clear_cache",security:rrzeFaudirAjax.api_nonce}).done(function(r){alert(r&&r.success?r.data:"Error clearing cache.")})}),i("#import-fau-person-button").on("click",function(){var e;window.rrzeFaudirAjax&&confirm(rrzeFaudirAjax.confirm_import)&&(i("#migration-progress").empty().append('<div id="import-progress"><div class="progress-bar" style="width:0%;height:20px;background-color:#4CAF50;"></div></div><div id="import-response" style="margin-top:10px;"></div>'),e=setInterval(function(){var r=i("#import-progress .progress-bar"),e=parseInt(r.css("width"))/i("#import-progress").width()*100||0;r.css("width",Math.min(e+10,90)+"%")},500),i.post(rrzeFaudirAjax.ajax_url,{action:"rrze_faudir_import_fau_person",security:rrzeFaudirAjax.api_nonce}).done(function(r){clearInterval(e),i("#import-progress .progress-bar").css("width","100%"),r.success?(r=String(r.data).replace(/\n/g,"</li><li>"),i("#import-response").html('<ul style="max-width:75ch;"><li>'+r+"</li></ul>")):i("#import-response").html("<p>No contact from FAU Person imported.</p>")}).fail(function(){clearInterval(e),i("#import-progress .progress-bar").css("width","100%"),i("#import-response").html("<p>An error occurred during the import.</p>")}))}),i("#search-person-form").length&&(i("#search-person-form input").on("keypress",function(r){13===r.which&&(r.preventDefault(),i("#search-person-form").submit())}),i("#search-person-form input").on("input",function(){var r=!0;i('#search-person-form input[type="text"], #search-person-form input[type="email"]').each(function(){""!==i(this).val()&&(r=!1)}),1!==i("#given-name").val().length&&1!==i("#family-name").val().length||(r=!0),i("#search-person-form button").prop("disabled",r)}),i("#search-person-form").on("submit",function(r){var e,a,t,n;r.preventDefault(),window.rrzeFaudirAjax&&(r=i("#person-id").val().trim(),e=i("#given-name").val().trim(),a=i("#family-name").val().trim(),t=i("#email").val().trim(),n=i("#include-default-org").is(":checked")?"1":"0",r||e||a||t?i.post(rrzeFaudirAjax.ajax_url,{action:"rrze_faudir_search_person",security:rrzeFaudirAjax.api_nonce,person_id:r,given_name:e,family_name:a,email:t,include_default_org:n}).done(function(r){i("#contacts-list").html(r.success?r.data:"<p>"+r.data+"</p>")}).fail(function(){i("#contacts-list").html("<p>An error occurred during the request.</p>")}):i("#contacts-list").html("<p>Please enter a valid search term.</p>"))})),i(document).on("click",".add-person",function(){var a,r,e,t,n;window.rrzeFaudirAjax&&(r=(a=i(this)).data("name"),e=a.data("id"),t=a.data("include-default-org"),n=a.data("functionLabel")||[],a.prop("disabled",!0).html('<span class="dashicons dashicons-update"></span> '+rrzeFaudirAjax.add_text),i.post(rrzeFaudirAjax.ajax_url,{action:"rrze_faudir_create_custom_person",security:rrzeFaudirAjax.api_nonce,person_name:r,person_id:e,include_default_org:t,functions:n}).done(function(r){var e;r.success?(e=i("<a>",{href:r.data.edit_url,class:"edit-person button",html:'<span class="dashicons dashicons-edit"></span> '+rrzeFaudirAjax.edit_text}),a.replaceWith(e)):alert("Error creating custom person: "+(r.data||"Unknown error"))}).fail(function(){alert("An error occurred while creating the custom person.")}).always(function(){a.prop("disabled",!1).html("Add")}))}),i("#search-org-form").length&&(i("#search-org-form").on("submit",function(r){r.preventDefault(),window.rrzeFaudirAjax&&((r=i("#org-search").val().trim())?i.post(rrzeFaudirAjax.ajax_url,{action:"rrze_faudir_search_org",security:rrzeFaudirAjax.api_nonce,search_term:r}).done(function(r){i("#organizations-list").html(r.success?r.data:"<p>"+r.data+"</p>")}).fail(function(){i("#organizations-list").html("<p>An error occurred during the request.</p>")}):i("#organizations-list").html("<p>Please enter a search term.</p>"))}),i("#search-org-form input").on("keypress",function(r){13===r.which&&(r.preventDefault(),i("#search-org-form").submit())}))}),jQuery(document).ready(function(r){var e='[faudir identifier="'+r("#hidden-person-id").val()+'"]';r("#generated-shortcode").val(e),r("#copy-shortcode").on("click",function(){r("#generated-shortcode").select(),document.execCommand("copy"),alert("Shortcode copied to clipboard!")})});