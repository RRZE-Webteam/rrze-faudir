(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var o in r)e.o(r,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:r[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.blocks,r=window.wp.i18n,o=window.wp.blockEditor,a=window.wp.components,l=window.wp.element,i=window.wp.serverSideRender;var s=e.n(i);const n=window.wp.apiFetch;var d=e.n(n);const u=window.ReactJSXRuntime,c=JSON.parse('{"UU":"rrze-faudir/block"}');(0,t.registerBlockType)(c.UU,{edit:function({attributes:e,setAttributes:t}){console.log("Translation system test:",{displayName:{translated:(0,r.__)("Display Name","rrze-faudir"),expected:"Anzeigename"},email:{translated:(0,r.__)("Email","rrze-faudir"),expected:"E-Mail"},phone:{translated:(0,r.__)("Phone","rrze-faudir"),expected:"Telefon"},textDomain:"rrze-faudir"});const[i,n]=(0,l.useState)([]),[c,f]=(0,l.useState)([]),[_,p]=(0,l.useState)(!0),[g,m]=(0,l.useState)(!1),[h,z]=(0,l.useState)(""),[x,b]=(0,l.useState)(null),[y,F]=(0,l.useState)(0),C=(0,o.useBlockProps)(),{selectedCategory:v="",selectedPosts:T=[],showCategory:j="",showPosts:k="",selectedPersonIds:w="",selectedFormat:N="kompakt",selectedFields:P=[],groupId:S="",function:I="",orgnr:$="",url:O="",buttonText:E="",hideFields:B=[],sort:D="last_name"}=e,A={displayName:(0,r.__)("Display Name","rrze-faudir"),personalTitle:(0,r.__)("Academic Title","rrze-faudir"),givenName:(0,r.__)("First Name","rrze-faudir"),familyName:(0,r.__)("Last Name","rrze-faudir"),personalTitleSuffix:(0,r.__)("Academic Suffix","rrze-faudir"),titleOfNobility:(0,r.__)("Title of Nobility","rrze-faudir"),email:(0,r.__)("Email","rrze-faudir"),phone:(0,r.__)("Phone","rrze-faudir"),organization:(0,r.__)("Organization","rrze-faudir"),function:(0,r.__)("Function","rrze-faudir"),url:(0,r.__)("Url","rrze-faudir"),kompaktButton:(0,r.__)("Kompakt Button","rrze-faudir"),content:(0,r.__)("Content","rrze-faudir"),teasertext:(0,r.__)("Teasertext","rrze-faudir"),socialmedia:(0,r.__)("Social Media","rrze-faudir"),workplaces:(0,r.__)("Workplaces","rrze-faudir"),room:(0,r.__)("Room","rrze-faudir"),floor:(0,r.__)("Floor","rrze-faudir"),street:(0,r.__)("Street","rrze-faudir"),zip:(0,r.__)("Zip","rrze-faudir"),city:(0,r.__)("City","rrze-faudir"),faumap:(0,r.__)("Fau Map","rrze-faudir"),officehours:(0,r.__)("Office Hours","rrze-faudir"),consultationhours:(0,r.__)("Consultation Hours","rrze-faudir")},L={card:["displayName","personalTitle","givenName","familyName","personalTitleSuffix","email","phone","function","socialmedia","titleOfNobility"],table:["displayName","personalTitle","givenName","familyName","personalTitleSuffix","email","phone","url","socialmedia","titleOfNobility"],list:["displayName","personalTitle","givenName","familyName","personalTitleSuffix","email","phone","url","teasertext","titleOfNobility"],kompakt:Object.keys(A),page:Object.keys(A)};(0,l.useEffect)((()=>{e.selectedFields&&0!==e.selectedFields.length||d()({path:"/wp/v2/settings/rrze_faudir_options"}).then((e=>{if(e?.default_output_fields){const r={display_name:"displayName",academic_title:"personalTitle",first_name:"givenName",last_name:"familyName",academic_suffix:"personalTitleSuffix",nobility_title:"titleOfNobility",email:"email",phone:"phone",organization:"organization",function:"function",url:"url",kompaktButton:"kompaktButton",content:"content",teasertext:"teasertext",socialmedia:"socialmedia",workplaces:"workplaces",room:"room",floor:"floor",street:"street",zip:"zip",city:"city",faumap:"faumap",officehours:"officehours",consultationhours:"consultationhours"},o=e.default_output_fields.map((e=>r[e])).filter((e=>void 0!==e));t({selectedFields:o})}})).catch((e=>{console.error("Error fetching default fields:",e)}))}),[]),(0,l.useEffect)((()=>{d()({path:"/wp/v2/custom_taxonomy?per_page=100"}).then((e=>{n(e),p(!1)})).catch((e=>{console.error("Error fetching categories:",e),p(!1)}))}),[]),(0,l.useEffect)((()=>{d()({path:"/wp/v2/settings/rrze_faudir_options"}).then((e=>{e?.default_organization?.orgnr&&(b(e.default_organization),console.log("Default org loaded:",e.default_organization))})).catch((e=>{console.error("Error fetching default organization number:",e)}))}),[]),(0,l.useEffect)((()=>{m(!0);const e={per_page:100,_fields:"id,title,meta",orderby:"title",order:"asc"};v&&(e.custom_taxonomy=v),d()({path:"/wp/v2/custom_person?per_page=100",params:e}).then((e=>{if(f(e),setDisplayedPosts(e.slice(0,100)),v){const r=e.map((e=>e.id)),o=e.map((e=>e.meta?.person_id)).filter(Boolean);t({selectedPosts:r,selectedPersonIds:o})}m(!1)})).catch((e=>{console.error("Error fetching posts:",e),m(!1)}))}),[v,I,$]),(0,l.useEffect)((()=>{E||d()({path:"/wp/v2/settings/rrze_faudir_options"}).then((e=>{e?.business_card_title&&(z(e.business_card_title),t({buttonText:e.business_card_title}))})).catch((e=>{console.error("Error fetching button text:",e)}))}),[]),console.log("Translation test:",(0,r.__)("Display Name","rrze-faudir"));const R={selectedPersonIds:e.selectedPersonIds,selectedFields:e.selectedFields,selectedFormat:e.selectedFormat,selectedCategory:e.selectedCategory,groupId:e.groupId,function:e.function,...e.orgnr&&{orgnr:e.orgnr},url:e.url},[U,M]=(0,l.useState)(0);return(0,l.useEffect)((()=>{const e=setTimeout((()=>{M((e=>e+1))}),300);return()=>clearTimeout(e)}),[...Object.values(R),D]),(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(o.InspectorControls,{children:(0,u.jsxs)(a.PanelBody,{title:(0,r.__)("Settings","rrze-faudir"),children:[(0,u.jsx)(a.ToggleControl,{label:(0,r.__)("Show Category","rrze-faudir"),checked:j,onChange:()=>t({showCategory:!j})}),j&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("h4",{children:(0,r.__)("Select Category","rrze-faudir")}),i.map((e=>(0,u.jsx)(a.CheckboxControl,{label:e.name,checked:v===e.name,onChange:()=>{const r=v===e.name?"":e.name;t({selectedCategory:r,selectedPosts:""===r?[]:T,selectedPersonIds:""===r?[]:w})}},e.id)))]}),(0,u.jsx)(a.ToggleControl,{label:(0,r.__)("Show Persons","rrze-faudir"),checked:k,onChange:()=>t({showPosts:!k})}),k&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("h4",{children:(0,r.__)("Select Persons","rrze-faudir")}),console.log("Total posts available:",c.length),g?(0,u.jsx)("p",{children:(0,r.__)("Loading persons...","rrze-faudir")}):c.length>0?(0,u.jsx)(u.Fragment,{children:c.map((e=>(console.log("Rendering post:",e.title.rendered,e.id),(0,u.jsx)(a.CheckboxControl,{label:e.title.rendered,checked:Array.isArray(T)&&T.includes(e.id),onChange:()=>(e=>{const r=T.includes(e)?T.filter((t=>t!==e)):[...T,e],o=r.map((e=>{const t=c.find((t=>t.id===e));return t?.meta?.person_id||null})).filter(Boolean);t({selectedPosts:r,selectedPersonIds:o}),F((e=>e+1))})(e.id,e.meta)},e.id))))}):(0,u.jsx)("p",{children:(0,r.__)("No posts available.","rrze-faudir")})]}),(0,u.jsx)(a.SelectControl,{label:(0,r.__)("Select Format","rrze-faudir"),value:N||"list",options:[{value:"list",label:(0,r.__)("List","rrze-faudir")},{value:"table",label:(0,r.__)("Table","rrze-faudir")},{value:"card",label:(0,r.__)("Card","rrze-faudir")},{value:"kompakt",label:(0,r.__)("Kompakt","rrze-faudir")},{value:"page",label:(0,r.__)("Page","rrze-faudir")}],onChange:r=>{t({selectedFormat:r}),F((e=>e+1)),e.selectedFields&&0!==e.selectedFields.length||d()({path:"/wp/v2/settings/rrze_faudir_options"}).then((e=>{if(e?.default_output_fields){const o=L[r]||[],a=e.default_output_fields.filter((e=>o.includes(e)));t({selectedFields:a})}})).catch((e=>{console.error("Error fetching default fields:",e)}))}}),Object.keys(L).map((o=>N===o?(0,u.jsxs)("div",{children:[(0,u.jsx)("h4",{children:(0,r.__)("Select Fields","rrze-faudir")}),L[o].map((r=>(0,u.jsx)("div",{style:{marginBottom:"8px"},children:(0,u.jsx)(a.CheckboxControl,{label:(0,u.jsx)(u.Fragment,{children:A[r]}),checked:P.includes(r),onChange:()=>(r=>{const o=P.includes(r);let a,l=e.hideFields||[];o?(a=P.filter((e=>e!==r)),l=[...l,r]):(a=[...P,r],l=l.filter((e=>e!==r))),t({selectedFields:a,hideFields:l})})(r)})},r)))]},o):null)),(0,u.jsx)(a.TextControl,{label:(0,r.__)("Group Id","rrze-faudir"),value:S,onChange:e=>t({groupId:e})}),(0,u.jsx)(a.TextControl,{label:(0,r.__)("Function","rrze-faudir"),value:e.function||"",onChange:e=>t({function:e})}),(0,u.jsx)(a.TextControl,{label:(0,r.__)("Organization Nr","rrze-faudir"),value:$,onChange:e=>{console.log("Setting orgnr:",e),t({orgnr:e})}}),x&&!$&&(0,u.jsxs)("div",{style:{padding:"8px",backgroundColor:"#f0f0f0",borderLeft:"4px solid #007cba",marginTop:"5px",marginBottom:"15px"},children:[(0,u.jsx)("span",{className:"dashicons dashicons-info",style:{marginRight:"5px"}}),(0,r.__)("Default organization will be used if empty.","rrze-faudir")]}),(0,u.jsx)(a.TextControl,{label:(0,r.__)("Custom url","rrze-faudir"),value:O,onChange:e=>t({url:e})}),"kompakt"===N&&(0,u.jsx)(a.TextControl,{label:(0,r.__)("Button Text","rrze-faudir"),help:(0,r.__)("Default: ","rrze-faudir")+h,value:E,onChange:e=>t({buttonText:e}),placeholder:h}),(0,u.jsx)(a.SelectControl,{label:(0,r.__)("Sort by","rrze-faudir"),value:D,options:[{value:"last_name",label:(0,r.__)("Last Name","rrze-faudir")},{value:"title_last_name",label:(0,r.__)("Title and Last Name","rrze-faudir")},{value:"function_head",label:(0,r.__)("Head of Department First","rrze-faudir")},{value:"function_proffesor",label:(0,r.__)("Professors First","rrze-faudir")},{value:"identifier_order",label:(0,r.__)("Identifier Order","rrze-faudir")}],onChange:e=>{t({sort:e}),F((e=>e+1))}})]})}),(0,u.jsx)("div",{...C,children:e.selectedPersonIds?.length>0||e.selectedCategory||e.function&&(e.orgnr||x)?(0,u.jsxs)(u.Fragment,{children:[console.log("Shortcode:",`[faudir ${e.function?`function="${e.function}"${e.orgnr?` orgnr="${e.orgnr}"`:""}`:`${e.selectedCategory?`category="${e.selectedCategory}"`:""}${e.selectedPersonIds?.length?` identifiers="${e.selectedPersonIds}"`:""}`}${e.selectedFormat?` format="${e.selectedFormat}"`:""}${e.selectedFields?.length?` fields="${e.selectedFields.join(",")}"`:""}${e.sort?` sort="${e.sort}"`:""}${e.buttonText?` button_text="${e.buttonText}"`:""}${e.url?` url="${e.url}"`:""}${e.groupId?` group_id="${e.groupId}"`:""}]`),(0,u.jsx)(s(),{block:"rrze-faudir/block",attributes:{...e.function?{function:e.function,...e.orgnr&&{orgnr:e.orgnr},selectedFormat:e.selectedFormat,selectedFields:e.selectedFields,buttonText:e.buttonText,url:e.url,sort:e.sort}:e.selectedCategory?{selectedCategory:e.selectedCategory,selectedPersonIds:e.selectedPersonIds,selectedFormat:e.selectedFormat,selectedFields:e.selectedFields,buttonText:e.buttonText,url:e.url,groupId:e.groupId,sort:e.sort,hideFields:e.hideFields}:{selectedPersonIds:e.selectedPersonIds,selectedFields:e.selectedFields,selectedFormat:e.selectedFormat,buttonText:e.buttonText,url:e.url,groupId:e.groupId,sort:e.sort}}},y)]}):(0,u.jsx)("div",{style:{padding:"20px",backgroundColor:"#f8f9fa",textAlign:"center"},children:(0,u.jsx)("p",{children:e.function?x?(0,r.__)("Using default organization.","rrze-faudir"):(0,r.__)("Please configure a default organization in the plugin settings or add an organization ID to display results.","rrze-faudir"):(0,r.__)("Please select persons or a category to display using the sidebar controls.","rrze-faudir")})})})]})},save:()=>null})})();