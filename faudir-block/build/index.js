(()=>{"use strict";var e={n:r=>{var t=r&&r.__esModule?()=>r.default:()=>r;return e.d(t,{a:t}),t},d:(r,t)=>{for(var a in t)e.o(t,a)&&!e.o(r,a)&&Object.defineProperty(r,a,{enumerable:!0,get:t[a]})},o:(e,r)=>Object.prototype.hasOwnProperty.call(e,r)};const r=window.wp.blocks,t=window.wp.i18n,a=window.wp.blockEditor,o=window.wp.components,l=window.wp.element,s=window.wp.serverSideRender;var i=e.n(s);const n=window.wp.apiFetch;var d=e.n(n);const u=window.ReactJSXRuntime,c=JSON.parse('{"UU":"rrze-faudir/block"}');(0,r.registerBlockType)(c.UU,{edit:function({attributes:e,setAttributes:r}){console.log("Translation system test:",{displayName:{translated:(0,t.__)("Display Name","rrze-faudir"),expected:"Anzeigename"},email:{translated:(0,t.__)("Email","rrze-faudir"),expected:"E-Mail"},phone:{translated:(0,t.__)("Phone","rrze-faudir"),expected:"Telefon"},textDomain:"rrze-faudir"});const[s,n]=(0,l.useState)([]),[c,f]=(0,l.useState)([]),[_,p]=(0,l.useState)(!0),[g,m]=(0,l.useState)(!1),[h,z]=(0,l.useState)(""),[b,x]=(0,l.useState)(null),[y,C]=(0,l.useState)(0),F=(0,a.useBlockProps)(),{selectedCategory:v="",selectedPosts:w=[],showCategory:T="",showPosts:j="",selectedPersonIds:k="",selectedFormat:S="kompakt",selectedFields:N=[],groupId:P="",function:I="",orgnr:E="",url:O="",buttonText:B="",hideFields:A=[],sort:D="last_name"}=e,L={displayName:(0,t.__)("Display Name","rrze-faudir"),personalTitle:(0,t.__)("Academic Title","rrze-faudir"),givenName:(0,t.__)("First Name","rrze-faudir"),familyName:(0,t.__)("Last Name","rrze-faudir"),personalTitleSuffix:(0,t.__)("Academic Suffix","rrze-faudir"),titleOfNobility:(0,t.__)("Title of Nobility","rrze-faudir"),email:(0,t.__)("Email","rrze-faudir"),phone:(0,t.__)("Phone","rrze-faudir"),organization:(0,t.__)("Organization","rrze-faudir"),function:(0,t.__)("Function","rrze-faudir"),url:(0,t.__)("Url","rrze-faudir"),kompaktButton:(0,t.__)("Kompakt Button","rrze-faudir"),content:(0,t.__)("Content","rrze-faudir"),teasertext:(0,t.__)("Teasertext","rrze-faudir"),socialmedia:(0,t.__)("Social Media","rrze-faudir"),workplaces:(0,t.__)("Workplaces","rrze-faudir"),room:(0,t.__)("Room","rrze-faudir"),floor:(0,t.__)("Floor","rrze-faudir"),street:(0,t.__)("Street","rrze-faudir"),zip:(0,t.__)("Zip","rrze-faudir"),city:(0,t.__)("City","rrze-faudir"),faumap:(0,t.__)("Fau Map","rrze-faudir"),officehours:(0,t.__)("Office Hours","rrze-faudir"),consultationhours:(0,t.__)("Consultation Hours","rrze-faudir")},U={card:["displayName","personalTitle","givenName","familyName","personalTitleSuffix","email","phone","function","socialmedia","titleOfNobility"],table:["displayName","personalTitle","givenName","familyName","personalTitleSuffix","email","phone","url","socialmedia","titleOfNobility"],list:["displayName","personalTitle","givenName","familyName","personalTitleSuffix","email","phone","url","teasertext","titleOfNobility"],kompakt:Object.keys(L),page:Object.keys(L)};(0,l.useEffect)((()=>{e.selectedFields&&0!==e.selectedFields.length||d()({path:"/wp/v2/settings/rrze_faudir_options"}).then((e=>{e?.default_output_fields&&r({selectedFields:e.default_output_fields})})).catch((e=>{console.error("Error fetching default fields:",e)}))}),[]),(0,l.useEffect)((()=>{d()({path:"/wp/v2/custom_taxonomy?per_page=100"}).then((e=>{n(e),p(!1)})).catch((e=>{console.error("Error fetching categories:",e),p(!1)}))}),[]),(0,l.useEffect)((()=>{d()({path:"/wp/v2/settings/rrze_faudir_options"}).then((e=>{e?.default_organization?.orgnr&&(x(e.default_organization.orgnr),I&&!E&&r({orgnr:e.default_organization.orgnr}))})).catch((e=>{console.error("Error fetching default organization number:",e)}))}),[]),(0,l.useEffect)((()=>{m(!0);const e={per_page:100,_fields:"id,title,meta",orderby:"title",order:"asc"};if(v&&(e.custom_taxonomy=v),I){e.function=I;const r=E||b;r&&(e.organization_nr=r)}d()({path:"/wp/v2/custom_person",params:e}).then((e=>{if(f(e),v&&(!w||0===w.length)){const t=e.map((e=>e.id)),a=e.map((e=>e.meta?.person_id)).filter(Boolean);r({selectedPosts:t,selectedPersonIds:a})}m(!1)})).catch((e=>{console.error("Error fetching posts:",e),m(!1)}))}),[v,I,E,b]),(0,l.useEffect)((()=>{B||d()({path:"/wp/v2/settings/rrze_faudir_options"}).then((e=>{e?.business_card_title&&(z(e.business_card_title),r({buttonText:e.business_card_title}))})).catch((e=>{console.error("Error fetching button text:",e)}))}),[]),console.log("Translation test:",(0,t.__)("Display Name","rrze-faudir")),e.selectedPersonIds,e.selectedFields,e.selectedFormat,e.selectedCategory,e.groupId,e.function,e.orgnr,e.url;const[M,R]=(0,l.useState)(0);return(0,l.useEffect)((()=>{const e=setTimeout((()=>{R((e=>e+1))}),300);return()=>clearTimeout(e)}),[...Object.values(e),D]),(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(a.InspectorControls,{children:(0,u.jsxs)(o.PanelBody,{title:(0,t.__)("Settings","rrze-faudir"),children:[(0,u.jsx)(o.ToggleControl,{label:(0,t.__)("Show Category","rrze-faudir"),checked:T,onChange:()=>r({showCategory:!T})}),T&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("h4",{children:(0,t.__)("Select Category","rrze-faudir")}),s.map((e=>(0,u.jsx)(o.CheckboxControl,{label:e.name,checked:v===e.name,onChange:()=>{const t=v===e.name?"":e.name;r({selectedCategory:t,selectedPosts:""===t?[]:w,selectedPersonIds:""===t?[]:k})}},e.id)))]}),(0,u.jsx)(o.ToggleControl,{label:(0,t.__)("Show Persons","rrze-faudir"),checked:j,onChange:()=>r({showPosts:!j})}),j&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("h4",{children:(0,t.__)("Select Persons","rrze-faudir")}),g?(0,u.jsx)("p",{children:(0,t.__)("Loading persons...","rrze-faudir")}):c.length>0?c.map((e=>(0,u.jsx)(o.CheckboxControl,{label:e.title.rendered,checked:Array.isArray(w)&&w.includes(e.id),onChange:()=>(e=>{const t=w.includes(e)?w.filter((r=>r!==e)):[...w,e],a=t.map((e=>{const r=c.find((r=>r.id===e));return r?.meta?.person_id||null})).filter(Boolean);r({selectedPosts:t,selectedPersonIds:a}),C((e=>e+1))})(e.id,e.meta)},e.id))):(0,u.jsx)("p",{children:(0,t.__)("No posts available.","rrze-faudir")})]}),(0,u.jsx)(o.SelectControl,{label:(0,t.__)("Select Format","rrze-faudir"),value:S||"list",options:[{value:"list",label:(0,t.__)("List","rrze-faudir")},{value:"table",label:(0,t.__)("Table","rrze-faudir")},{value:"card",label:(0,t.__)("Card","rrze-faudir")},{value:"kompakt",label:(0,t.__)("Kompakt","rrze-faudir")},{value:"page",label:(0,t.__)("Page","rrze-faudir")}],onChange:t=>{r({selectedFormat:t}),C((e=>e+1)),e.selectedFields&&0!==e.selectedFields.length||d()({path:"/wp/v2/settings/rrze_faudir_options"}).then((e=>{if(e?.default_output_fields){const a=U[t]||[],o=e.default_output_fields.filter((e=>a.includes(e)));r({selectedFields:o})}})).catch((e=>{console.error("Error fetching default fields:",e)}))}}),Object.keys(U).map((a=>S===a?(0,u.jsxs)("div",{children:[(0,u.jsx)("h4",{children:(0,t.__)("Select Fields","rrze-faudir")}),U[a].map((t=>(0,u.jsx)("div",{style:{marginBottom:"8px"},children:(0,u.jsx)(o.CheckboxControl,{label:(0,u.jsx)(u.Fragment,{children:L[t]}),checked:N.includes(t),onChange:()=>(t=>{const a=N.includes(t);let o,l=e.hideFields||[];a?(o=N.filter((e=>e!==t)),l=[...l,t]):(o=[...N,t],l=l.filter((e=>e!==t))),r({selectedFields:o,hideFields:l})})(t)})},t)))]},a):null)),(0,u.jsx)(o.TextControl,{label:(0,t.__)("Group Id","rrze-faudir"),value:P,onChange:e=>r({groupId:e})}),(0,u.jsx)(o.TextControl,{label:(0,t.__)("Function","rrze-faudir"),value:e.function||"",onChange:e=>r({function:e})}),(0,u.jsx)(o.TextControl,{label:(0,t.__)("Organization Nr","rrze-faudir"),value:E,onChange:e=>{console.log("Setting orgnr:",e),r({orgnr:e})}}),(0,u.jsx)(o.TextControl,{label:(0,t.__)("Custom url","rrze-faudir"),value:O,onChange:e=>r({url:e})}),"kompakt"===S&&(0,u.jsx)(o.TextControl,{label:(0,t.__)("Button Text","rrze-faudir"),help:(0,t.__)("Default: ","rrze-faudir")+h,value:B,onChange:e=>r({buttonText:e}),placeholder:h}),(0,u.jsx)(o.SelectControl,{label:(0,t.__)("Sort by","rrze-faudir"),value:D,options:[{value:"last_name",label:(0,t.__)("Last Name","rrze-faudir")},{value:"title_last_name",label:(0,t.__)("Title and Last Name","rrze-faudir")},{value:"function_head",label:(0,t.__)("Head of Department First","rrze-faudir")},{value:"function_proffesor",label:(0,t.__)("Professors First","rrze-faudir")},{value:"identifier_order",label:(0,t.__)("Identifier Order","rrze-faudir")}],onChange:e=>{r({sort:e}),C((e=>e+1))}})]})}),(0,u.jsx)("div",{...F,children:e.selectedPersonIds?.length>0||e.selectedCategory||e.function&&e.orgnr?(0,u.jsx)(i(),{block:"rrze-faudir/block",attributes:{...e.function&&e.orgnr?{function:e.function,orgnr:e.orgnr,selectedFormat:e.selectedFormat,selectedFields:e.selectedFields,buttonText:e.buttonText,url:e.url,sort:e.sort}:e.selectedCategory?{selectedCategory:e.selectedCategory,selectedFormat:e.selectedFormat,selectedFields:e.selectedFields,buttonText:e.buttonText,url:e.url,groupId:e.groupId,sort:e.sort}:{selectedPersonIds:e.selectedPersonIds,selectedFields:e.selectedFields,selectedFormat:e.selectedFormat,buttonText:e.buttonText,url:e.url,groupId:e.groupId,sort:e.sort}}},y):(0,u.jsx)("div",{style:{padding:"20px",backgroundColor:"#f8f9fa",textAlign:"center"},children:(0,u.jsx)("p",{children:e.function?(0,t.__)("Please add an organization ID to display results.","rrze-faudir"):(0,t.__)("Please select persons or a category to display using the sidebar controls.","rrze-faudir")})})})]})},save:()=>null})})();