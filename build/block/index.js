(()=>{"use strict";var e={n:r=>{var t=r&&r.__esModule?()=>r.default:()=>r;return e.d(t,{a:t}),t},d:(r,t)=>{for(var i in t)e.o(t,i)&&!e.o(r,i)&&Object.defineProperty(r,i,{enumerable:!0,get:t[i]})},o:(e,r)=>Object.prototype.hasOwnProperty.call(e,r)};const r=window.wp.blocks,t=window.ReactJSXRuntime,i=window.wp.i18n,l=window.wp.blockEditor,a=window.wp.components,o=window.wp.element,s=window.wp.serverSideRender;var d=e.n(s);const n=window.wp.apiFetch;var c=e.n(n);const f={image:(0,i.__)("Image","rrze-faudir"),displayName:(0,i.__)("Display Name","rrze-faudir"),honorificPrefix:(0,i.__)("Academic Title","rrze-faudir"),givenName:(0,i.__)("First Name","rrze-faudir"),familyName:(0,i.__)("Last Name","rrze-faudir"),honorificSuffix:(0,i.__)("Academic Suffix","rrze-faudir"),titleOfNobility:(0,i.__)("Title of Nobility","rrze-faudir"),email:(0,i.__)("Email","rrze-faudir"),phone:(0,i.__)("Phone","rrze-faudir"),organization:(0,i.__)("Organization","rrze-faudir"),jobTitle:(0,i.__)("Jobtitle","rrze-faudir"),url:(0,i.__)("URL","rrze-faudir"),content:(0,i.__)("Content","rrze-faudir"),teasertext:(0,i.__)("Teasertext","rrze-faudir"),socialmedia:(0,i.__)("Social Media and Websites","rrze-faudir"),room:(0,i.__)("Room","rrze-faudir"),floor:(0,i.__)("Floor","rrze-faudir"),address:(0,i.__)("Address","rrze-faudir"),street:(0,i.__)("Street","rrze-faudir"),zip:(0,i.__)("ZIP Code","rrze-faudir"),city:(0,i.__)("City","rrze-faudir"),faumap:(0,i.__)("FAU Map","rrze-faudir"),officehours:(0,i.__)("Office Hours","rrze-faudir"),consultationhours:(0,i.__)("Consultation Hours","rrze-faudir")},u={card:["image","displayName","honorificPrefix","givenName","familyName","honorificSuffix","email","phone","jobTitle","socialmedia","titleOfNobility","organization"],table:["image","displayName","honorificPrefix","givenName","familyName","honorificSuffix","email","phone","url","socialmedia","titleOfNobility","floor","room","address","organization"],list:["displayName","honorificPrefix","givenName","familyName","honorificSuffix","email","phone","url","teasertext","titleOfNobility","address"],compact:Object.keys(f),page:Object.keys(f)},m={image:"image",displayname:"displayName",honorificPrefix:"honorificPrefix",givenName:"givenName",familyName:"familyName",honorificSuffix:"honorificSuffix",titleOfNobility:"titleOfNobility",email:"email",phone:"phone",organization:"organization",jobTitle:"jobTitle",url:"url",content:"content",teasertext:"teasertext",socialmedia:"socialmedia",room:"room",floor:"floor",street:"street",zip:"zip",city:"city",faumap:"faumap",officehours:"officehours",consultationhours:"consultationhours",address:"address"},_=JSON.parse('{"UU":"rrze-faudir/block"}');(0,r.registerBlockType)(_.UU,{edit:function({attributes:e,setAttributes:r}){var s,n;const[_,p]=(0,o.useState)([]),[g,h]=(0,o.useState)([]),[y,z]=(0,o.useState)(!1),[b,x]=(0,o.useState)(null),[F,v]=(0,o.useState)(0),N=(0,l.useBlockProps)(),{selectedCategory:j="",selectedPosts:C=[],showCategory:P=!1,showPosts:w=!1,selectedPersonIds:S=[],selectedFormat:O="compact",selectedFields:T=[],role:k="",orgnr:I="",format_displayname:E="",sort:A="familyName"}=e;(0,o.useEffect)((()=>{e.selectedFields&&0!==e.selectedFields.length||c()({path:"/wp/v2/settings/rrze_faudir_options"}).then((e=>{if(console.log("DATA SETTINGS in component mount",e),null==e?void 0:e.default_output_fields){const t=e.default_output_fields.map((e=>m[e])).filter((e=>void 0!==e));r({selectedFields:t})}})).catch((e=>{console.error("Error fetching default fields:",e)}))}),[]),(0,o.useEffect)((()=>{c()({path:"/wp/v2/custom_taxonomy?per_page=100"}).then((e=>{p(e)})).catch((e=>{console.error("Error fetching categories:",e)}))}),[]),(0,o.useEffect)((()=>{c()({path:"/wp/v2/settings/rrze_faudir_options"}).then((e=>{var r;(null===(r=null==e?void 0:e.default_organization)||void 0===r?void 0:r.orgnr)&&x(e.default_organization)})).catch((e=>{console.error("Error fetching default organization number:",e)}))}),[]),(0,o.useEffect)((()=>{z(!0);const e={per_page:100,_fields:"id,title,meta",orderby:"title",order:"asc"};j&&(e.custom_taxonomy=j),c()({path:"/wp/v2/custom_person?per_page=100",params:e}).then((e=>{if(h(e),j){const t=e.map((e=>e.id)),i=e.map((e=>{var r;return null===(r=e.meta)||void 0===r?void 0:r.person_id})).filter(Boolean);r({selectedPosts:t,selectedPersonIds:i})}z(!1)})).catch((e=>{console.error("Error fetching posts:",e),z(!1)}))}),[j,I]);const B=Object.assign(Object.assign({selectedPersonIds:e.selectedPersonIds,selectedFields:e.selectedFields,selectedFormat:e.selectedFormat,selectedCategory:e.selectedCategory,role:e.role},e.orgnr&&{orgnr:e.orgnr}),{url:e.url,format_displayname:e.format_displayname}),[L,R]=(0,o.useState)(0);(0,o.useEffect)((()=>{const e=setTimeout((()=>{R((e=>e+1))}),300);return()=>clearTimeout(e)}),[...Object.values(B),A,E]);const U=function(e){const[r,t]=(0,o.useState)(e);return(0,o.useEffect)((()=>{const r=setTimeout((()=>{t(e)}),500);return()=>{clearTimeout(r)}}),[e,500]),r}(F);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.InspectorControls,{children:(0,t.jsxs)(a.PanelBody,{title:(0,i.__)("Settings","rrze-faudir"),children:[(0,t.jsx)(a.ToggleControl,{label:(0,i.__)("Show Category","rrze-faudir"),checked:P,onChange:()=>r({showCategory:!P})}),P&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("h4",{children:(0,i.__)("Select Category","rrze-faudir")}),_.map((e=>(0,t.jsx)(a.CheckboxControl,{label:e.name,checked:j===e.name,onChange:()=>{const t=j===e.name?"":e.name;r({selectedCategory:t,selectedPosts:""===t?[]:C,selectedPersonIds:""===t?[]:S})}},e.id)))]}),(0,t.jsx)(a.ToggleControl,{label:(0,i.__)("Show Persons","rrze-faudir"),checked:w,onChange:()=>r({showPosts:!w})}),w&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("h4",{children:(0,i.__)("Select Persons","rrze-faudir")}),y?(0,t.jsx)("p",{children:(0,i.__)("Loading persons...","rrze-faudir")}):g.length>0?(0,t.jsx)(t.Fragment,{children:g.map((e=>(0,t.jsx)(a.CheckboxControl,{label:e.title.rendered,checked:Array.isArray(C)&&C.includes(e.id),onChange:()=>(e=>{const t=C.includes(e)?C.filter((r=>r!==e)):[...C,e],i=t.map((e=>{var r;const t=g.find((r=>r.id===e));return(null===(r=null==t?void 0:t.meta)||void 0===r?void 0:r.person_id)||null})).filter(Boolean);r({selectedPosts:t,selectedPersonIds:i}),v((e=>e+1))})(e.id)},e.id)))}):(0,t.jsx)("p",{children:(0,i.__)("No posts available.","rrze-faudir")})]}),(0,t.jsx)(a.SelectControl,{label:(0,i.__)("Select Format","rrze-faudir"),value:O||"list",options:[{value:"list",label:(0,i.__)("List","rrze-faudir")},{value:"table",label:(0,i.__)("Table","rrze-faudir")},{value:"card",label:(0,i.__)("Card","rrze-faudir")},{value:"compact",label:(0,i.__)("Compact","rrze-faudir")},{value:"page",label:(0,i.__)("Page","rrze-faudir")}],onChange:t=>{r({selectedFormat:t}),v((e=>e+1)),e.selectedFields&&0!==e.selectedFields.length||c()({path:"/wp/v2/settings/rrze_faudir_options"}).then((e=>{if(null==e?void 0:e.default_output_fields){const i=u[t]||[],l=e.default_output_fields.filter((e=>i.includes(e)));r({selectedFields:l})}})).catch((e=>{console.error("Error fetching default fields:",e)}))}}),Object.keys(u).map((l=>O===l?(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{children:(0,i.__)("Select Fields","rrze-faudir")}),u[l].map((i=>(0,t.jsx)("div",{style:{marginBottom:"8px"},children:(0,t.jsx)(a.CheckboxControl,{label:String(f[i]),checked:T.includes(i),onChange:()=>(t=>{const i=T.includes(t);let l,a=e.hideFields||[];const o=["personalTitle","givenName","familyName","honorificSuffix","titleOfNobility"];"displayName"===t?i?(l=T.filter((e=>!o.includes(e)&&"displayName"!==e)),a=[...a,"displayName",...o]):(l=[...T.filter((e=>!o.includes(e))),"displayName",...o],a=a.filter((e=>!o.includes(e)&&"displayName"!==e))):o.includes(t)?i?(l=T.filter((e=>e!==t&&"displayName"!==e)),a=[...a,t]):(l=[...T.filter((e=>"displayName"!==e)),t],a=a.filter((e=>e!==t))):i?(l=T.filter((e=>e!==t)),a=[...a,t]):(l=[...T,t],a=a.filter((e=>e!==t))),r({selectedFields:l,hideFields:a}),v((e=>e+1))})(i)})},i)))]},l):null)),(0,t.jsx)(a.TextControl,{label:(0,i.__)("Organization Number","rrze-faudir"),value:I,onChange:e=>{r({orgnr:e}),e.length>8&&v((e=>e+1))},type:"text",help:(0,i.__)("Please enter at least 10 digits.","rrze-faudir")}),b&&!I&&(0,t.jsxs)("div",{style:{padding:"8px",backgroundColor:"#f0f0f0",borderLeft:"4px solid #007cba",marginTop:"5px",marginBottom:"15px"},children:[(0,t.jsx)("span",{className:"dashicons dashicons-info",style:{marginRight:"5px"}}),(0,i.__)("Default organization will be used if empty.","rrze-faudir")]}),(0,t.jsx)(a.SelectControl,{label:(0,i.__)("Sort by","rrze-faudir"),value:A,options:[{value:"familyName",label:(0,i.__)("Last Name","rrze-faudir")},{value:"title_familyName",label:(0,i.__)("Title and Last Name","rrze-faudir")},{value:"head_first",label:(0,i.__)("Head of Department First","rrze-faudir")},{value:"prof_first",label:(0,i.__)("Professors First","rrze-faudir")},{value:"identifier_order",label:(0,i.__)("Identifier Order","rrze-faudir")}],onChange:e=>{r({sort:e}),v((e=>e+1))}}),(0,t.jsx)(a.TextControl,{label:(0,i.__)("Role","rrze-faudir"),value:k,onChange:e=>r({role:e}),type:"text"}),(0,t.jsx)(a.TextControl,{label:(0,i.__)("Change display format","rrze-faudir"),value:E,onChange:e=>{r({format_displayname:e}),e.length>6&&v((e=>e+1))},type:"text"})]})}),(0,t.jsx)("div",Object.assign({},N,{children:(null===(s=e.selectedPersonIds)||void 0===s?void 0:s.length)>0||e.selectedCategory||e.orgnr||e.role&&(e.orgnr||b)?(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(d(),{block:"rrze-faudir/block",attributes:Object.assign({},e.role?Object.assign(Object.assign({role:e.role},e.orgnr&&{orgnr:e.orgnr}),{selectedFormat:e.selectedFormat,selectedFields:e.selectedFields.length>0?e.selectedFields:null,hideFields:e.hideFields,url:e.url,sort:e.sort,format_displayname:e.format_displayname}):e.selectedCategory?{selectedCategory:e.selectedCategory,selectedPersonIds:e.selectedPersonIds,selectedFormat:e.selectedFormat,selectedFields:e.selectedFields.length>0?e.selectedFields:null,hideFields:e.hideFields,url:e.url,sort:e.sort,format_displayname:e.format_displayname}:(null===(n=e.selectedPersonIds)||void 0===n?void 0:n.length)>0?{selectedPersonIds:e.selectedPersonIds,selectedFields:e.selectedFields.length>0?e.selectedFields:null,hideFields:e.hideFields,selectedFormat:e.selectedFormat,url:e.url,sort:e.sort,format_displayname:e.format_displayname}:e.orgnr?{orgnr:e.orgnr,selectedFormat:e.selectedFormat,selectedFields:e.selectedFields.length>0?e.selectedFields:null,hideFields:e.hideFields,url:e.url,sort:e.sort,format_displayname:e.format_displayname}:{selectedFormat:e.selectedFormat,selectedFields:e.selectedFields.length>0?e.selectedFields:null,hideFields:e.hideFields,url:e.url,sort:e.sort,format_displayname:e.format_displayname})},U)}):(0,t.jsx)("div",{style:{padding:"20px",backgroundColor:"#f8f9fa",textAlign:"center"},children:(0,t.jsx)("p",{children:e.role?b?(0,i.__)("Using default organization.","rrze-faudir"):(0,i.__)("Please configure a default organization in the plugin settings or add an organization ID to display results.","rrze-faudir"):(0,i.__)("Please select persons or a category to display using the sidebar controls.","rrze-faudir")})})}))]})},save:function(){return null}})})();