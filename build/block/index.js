(()=>{"use strict";const e=window.wp.blocks,r=window.wp.i18n,t=window.wp.blockEditor,i=window.wp.components,a=window.wp.element,l=window.wp.serverSideRender,s=window.wp.apiFetch,o=window.ReactJSXRuntime,d=JSON.parse('{"UU":"rrze-faudir/block"}');(0,e.registerBlockType)(d.UU,{edit:function({attributes:e,setAttributes:d}){const[n,c]=(0,a.useState)([]),[f,u,m]=(0,a.useState)([]),[_,p]=(0,a.useState)(!0),[h,g]=(0,a.useState)(!1),[y,z]=(0,a.useState)(null),[x,F]=(0,a.useState)(0),b=(0,t.useBlockProps)(),{selectedCategory:N="",selectedPosts:C=[],showCategory:j="",showPosts:v="",selectedPersonIds:P="",selectedFormat:w="compact",selectedFields:S=[],role:T="",orgnr:k="",format_displayname:I="",url:O="",hideFields:E=[],sort:A="familyName"}=e,B={image:(0,r.__)("Image","rrze-faudir"),displayName:(0,r.__)("Display Name","rrze-faudir"),honorificPrefix:(0,r.__)("Academic Title","rrze-faudir"),givenName:(0,r.__)("First Name","rrze-faudir"),familyName:(0,r.__)("Last Name","rrze-faudir"),honorificSuffix:(0,r.__)("Academic Suffix","rrze-faudir"),titleOfNobility:(0,r.__)("Title of Nobility","rrze-faudir"),email:(0,r.__)("Email","rrze-faudir"),phone:(0,r.__)("Phone","rrze-faudir"),organization:(0,r.__)("Organization","rrze-faudir"),jobTitle:(0,r.__)("Jobtitle","rrze-faudir"),url:(0,r.__)("URL","rrze-faudir"),content:(0,r.__)("Content","rrze-faudir"),teasertext:(0,r.__)("Teasertext","rrze-faudir"),socialmedia:(0,r.__)("Social Media and Websites","rrze-faudir"),room:(0,r.__)("Room","rrze-faudir"),floor:(0,r.__)("Floor","rrze-faudir"),address:(0,r.__)("Address","rrze-faudir"),street:(0,r.__)("Street","rrze-faudir"),zip:(0,r.__)("ZIP Code","rrze-faudir"),city:(0,r.__)("City","rrze-faudir"),faumap:(0,r.__)("FAU Map","rrze-faudir"),officehours:(0,r.__)("Office Hours","rrze-faudir"),consultationhours:(0,r.__)("Consultation Hours","rrze-faudir")},L={card:["image","displayName","honorificPrefix","givenName","familyName","honorificSuffix","email","phone","jobTitle","socialmedia","titleOfNobility","organization"],table:["image","displayName","honorificPrefix","givenName","familyName","honorificSuffix","email","phone","url","socialmedia","titleOfNobility","floor","room","address","organization"],list:["displayName","honorificPrefix","givenName","familyName","honorificSuffix","email","phone","url","teasertext","titleOfNobility","address"],compact:Object.keys(B),page:Object.keys(B)};(0,a.useEffect)((()=>{e.selectedFields&&0!==e.selectedFields.length||s({path:"/wp/v2/settings/rrze_faudir_options"}).then((e=>{if(e?.default_output_fields){const r={image:"image",displayname:"displayName",honorificPrefix:"honorificPrefix",givenName:"givenName",familyName:"familyName",honorificSuffix:"honorificSuffix",titleOfNobility:"titleOfNobility",email:"email",phone:"phone",organization:"organization",jobTitle:"jobTitle",url:"url",content:"content",teasertext:"teasertext",socialmedia:"socialmedia",room:"room",floor:"floor",street:"street",zip:"zip",city:"city",faumap:"faumap",officehours:"officehours",consultationhours:"consultationhours",address:"address"},t=e.default_output_fields.map((e=>r[e])).filter((e=>void 0!==e));d({selectedFields:t})}})).catch((e=>{console.error("Error fetching default fields:",e)}))}),[]),(0,a.useEffect)((()=>{s({path:"/wp/v2/custom_taxonomy?per_page=100"}).then((e=>{c(e),p(!1)})).catch((e=>{console.error("Error fetching categories:",e),p(!1)}))}),[]),(0,a.useEffect)((()=>{s({path:"/wp/v2/settings/rrze_faudir_options"}).then((e=>{e?.default_organization?.orgnr&&z(e.default_organization)})).catch((e=>{console.error("Error fetching default organization number:",e)}))}),[]),(0,a.useEffect)((()=>{g(!0);const e={per_page:100,_fields:"id,title,meta",orderby:"title",order:"asc"};N&&(e.custom_taxonomy=N),s({path:"/wp/v2/custom_person?per_page=100",params:e}).then((e=>{if(u(e),m(e.slice(0,100)),N){const r=e.map((e=>e.id)),t=e.map((e=>e.meta?.person_id)).filter(Boolean);d({selectedPosts:r,selectedPersonIds:t})}g(!1)})).catch((e=>{console.error("Error fetching posts:",e),g(!1)}))}),[N,k]);const R={selectedPersonIds:e.selectedPersonIds,selectedFields:e.selectedFields,selectedFormat:e.selectedFormat,selectedCategory:e.selectedCategory,role:e.role,...e.orgnr&&{orgnr:e.orgnr},url:e.url,format_displayname:e.format_displayname},[U,D]=(0,a.useState)(0);(0,a.useEffect)((()=>{const e=setTimeout((()=>{D((e=>e+1))}),300);return()=>clearTimeout(e)}),[...Object.values(R),A,I]),(0,a.useMemo)((()=>f.map((e=>({id:e.id,title:e.title.rendered,personId:e.meta?.person_id})))),[f]);const H=function(e){const[r,t]=(0,a.useState)(e);return(0,a.useEffect)((()=>{const r=setTimeout((()=>{t(e)}),500);return()=>{clearTimeout(r)}}),[e,500]),r}(x);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.InspectorControls,{children:(0,o.jsxs)(i.PanelBody,{title:(0,r.__)("Settings","rrze-faudir"),children:[(0,o.jsx)(i.ToggleControl,{label:(0,r.__)("Show Category","rrze-faudir"),checked:j,onChange:()=>d({showCategory:!j})}),j&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h4",{children:(0,r.__)("Select Category","rrze-faudir")}),n.map((e=>(0,o.jsx)(i.CheckboxControl,{label:e.name,checked:N===e.name,onChange:()=>{const r=N===e.name?"":e.name;d({selectedCategory:r,selectedPosts:""===r?[]:C,selectedPersonIds:""===r?[]:P})}},e.id)))]}),(0,o.jsx)(i.ToggleControl,{label:(0,r.__)("Show Persons","rrze-faudir"),checked:v,onChange:()=>d({showPosts:!v})}),v&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h4",{children:(0,r.__)("Select Persons","rrze-faudir")}),h?(0,o.jsx)("p",{children:(0,r.__)("Loading persons...","rrze-faudir")}):f.length>0?(0,o.jsx)(o.Fragment,{children:f.map((e=>(0,o.jsx)(i.CheckboxControl,{label:e.title.rendered,checked:Array.isArray(C)&&C.includes(e.id),onChange:()=>(e=>{const r=C.includes(e)?C.filter((r=>r!==e)):[...C,e],t=r.map((e=>{const r=f.find((r=>r.id===e));return r?.meta?.person_id||null})).filter(Boolean);d({selectedPosts:r,selectedPersonIds:t}),F((e=>e+1))})(e.id,e.meta)},e.id)))}):(0,o.jsx)("p",{children:(0,r.__)("No posts available.","rrze-faudir")})]}),(0,o.jsx)(i.SelectControl,{label:(0,r.__)("Select Format","rrze-faudir"),value:w||"list",options:[{value:"list",label:(0,r.__)("List","rrze-faudir")},{value:"table",label:(0,r.__)("Table","rrze-faudir")},{value:"card",label:(0,r.__)("Card","rrze-faudir")},{value:"compact",label:(0,r.__)("Compact","rrze-faudir")},{value:"page",label:(0,r.__)("Page","rrze-faudir")}],onChange:r=>{d({selectedFormat:r}),F((e=>e+1)),e.selectedFields&&0!==e.selectedFields.length||s({path:"/wp/v2/settings/rrze_faudir_options"}).then((e=>{if(e?.default_output_fields){const t=L[r]||[],i=e.default_output_fields.filter((e=>t.includes(e)));d({selectedFields:i})}})).catch((e=>{console.error("Error fetching default fields:",e)}))}}),Object.keys(L).map((t=>w===t?(0,o.jsxs)("div",{children:[(0,o.jsx)("h4",{children:(0,r.__)("Select Fields","rrze-faudir")}),L[t].map((r=>(0,o.jsx)("div",{style:{marginBottom:"8px"},children:(0,o.jsx)(i.CheckboxControl,{label:(0,o.jsx)(o.Fragment,{children:B[r]}),checked:S.includes(r),onChange:()=>(r=>{const t=S.includes(r);let i,a=e.hideFields||[];const l=["personalTitle","givenName","familyName","honorificSuffix","titleOfNobility"];"displayName"===r?t?(i=S.filter((e=>!l.includes(e)&&"displayName"!==e)),a=[...a,"displayName",...l]):(i=[...S.filter((e=>!l.includes(e))),"displayName",...l],a=a.filter((e=>!l.includes(e)&&"displayName"!==e))):l.includes(r)?t?(i=S.filter((e=>e!==r&&"displayName"!==e)),a=[...a,r]):(i=[...S.filter((e=>"displayName"!==e)),r],a=a.filter((e=>e!==r))):t?(i=S.filter((e=>e!==r)),a=[...a,r]):(i=[...S,r],a=a.filter((e=>e!==r))),d({selectedFields:i,hideFields:a}),F((e=>e+1))})(r)})},r)))]},t):null)),(0,o.jsx)(i.TextControl,{label:(0,r.__)("Organization Number","rrze-faudir"),value:k,onChange:e=>{d({orgnr:e}),e.length>8&&F((e=>e+1))},type:"text",help:(0,r.__)("Please enter at least 10 digits.","rrze-faudir"),inputProps:{pattern:"\\d{10,}"}}),y&&!k&&(0,o.jsxs)("div",{style:{padding:"8px",backgroundColor:"#f0f0f0",borderLeft:"4px solid #007cba",marginTop:"5px",marginBottom:"15px"},children:[(0,o.jsx)("span",{className:"dashicons dashicons-info",style:{marginRight:"5px"}}),(0,r.__)("Default organization will be used if empty.","rrze-faudir")]}),(0,o.jsx)(i.SelectControl,{label:(0,r.__)("Sort by","rrze-faudir"),value:A,options:[{value:"familyName",label:(0,r.__)("Last Name","rrze-faudir")},{value:"title_familyName",label:(0,r.__)("Title and Last Name","rrze-faudir")},{value:"head_first",label:(0,r.__)("Head of Department First","rrze-faudir")},{value:"prof_first",label:(0,r.__)("Professors First","rrze-faudir")},{value:"identifier_order",label:(0,r.__)("Identifier Order","rrze-faudir")}],onChange:e=>{d({sort:e}),F((e=>e+1))}}),(0,o.jsx)(i.TextControl,{label:(0,r.__)("Role","rrze-faudir"),value:T,onChange:e=>d({role:e}),type:"text"}),(0,o.jsx)(i.TextControl,{label:(0,r.__)("Change display format","rrze-faudir"),value:I,onChange:e=>{d({format_displayname:e}),e.length>6&&F((e=>e+1))},type:"text"})]})}),(0,o.jsx)("div",{...b,children:e.selectedPersonIds?.length>0||e.selectedCategory||e.orgnr||e.role&&(e.orgnr||y)?(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(l,{block:"rrze-faudir/block",attributes:{...e.role?{role:e.role,...e.orgnr&&{orgnr:e.orgnr},selectedFormat:e.selectedFormat,selectedFields:e.selectedFields.length>0?e.selectedFields:null,hideFields:e.hideFields,url:e.url,sort:e.sort,format_displayname:e.format_displayname}:e.selectedCategory?{selectedCategory:e.selectedCategory,selectedPersonIds:e.selectedPersonIds,selectedFormat:e.selectedFormat,selectedFields:e.selectedFields.length>0?e.selectedFields:null,hideFields:e.hideFields,url:e.url,sort:e.sort,format_displayname:e.format_displayname}:e.selectedPersonIds?.length>0?{selectedPersonIds:e.selectedPersonIds,selectedFields:e.selectedFields.length>0?e.selectedFields:null,hideFields:e.hideFields,selectedFormat:e.selectedFormat,url:e.url,sort:e.sort,format_displayname:e.format_displayname}:e.orgnr?{orgnr:e.orgnr,selectedFormat:e.selectedFormat,selectedFields:e.selectedFields.length>0?e.selectedFields:null,hideFields:e.hideFields,url:e.url,sort:e.sort,format_displayname:e.format_displayname}:{selectedFormat:e.selectedFormat,selectedFields:e.selectedFields.length>0?e.selectedFields:null,hideFields:e.hideFields,url:e.url,sort:e.sort,format_displayname:e.format_displayname}}},H)}):(0,o.jsx)("div",{style:{padding:"20px",backgroundColor:"#f8f9fa",textAlign:"center"},children:(0,o.jsx)("p",{children:e.role?y?(0,r.__)("Using default organization.","rrze-faudir"):(0,r.__)("Please configure a default organization in the plugin settings or add an organization ID to display results.","rrze-faudir"):(0,r.__)("Please select persons or a category to display using the sidebar controls.","rrze-faudir")})})})]})},save:()=>null})})();